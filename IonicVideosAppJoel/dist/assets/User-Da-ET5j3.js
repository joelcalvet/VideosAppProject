import{d as P,r as c,l as S,m as q,c as k,w as l,u as a,I as H,k as C,e as o,n as w,p as V,j as r,q as B,s as L,t as G,v as u,x as R,F as z,y as A,H as J,J as O,i as _,f as D,g as F,G as g,h as K,z as Q,o as n,A as W,B as X,C as Y,D as Z,E as ee,_ as ae}from"./index-g3H4iXOq.js";const te=["src"],le=["src"],oe={key:2,class:"unsupported"},se={class:"button-container"},ne=["src"],re=["src"],de={key:2,class:"unsupported"},ue=P({__name:"User",setup(ie){const d=c([]),I=c(!1),f=c(null),m=c(""),i=c(""),p=c(null),M=Q(),E=async()=>{try{const t=await C.get("/user/multimedia");d.value=t.data}catch(t){console.error("Error carregant el meu multimèdia:",t)}},h=t=>/\.(jpg|jpeg|png|gif)$/i.test(t),x=t=>/\.(mp4|webm|ogg)$/i.test(t),$=t=>{f.value=t.id,m.value=t.title||"",i.value=t.path,p.value=null,I.value=!0},y=()=>{I.value=!1,f.value=null,m.value="",i.value="",p.value=null},N=t=>{const e=t.target;e.files&&(p.value=e.files[0])},U=async()=>{var e;if(!f.value)return;const t=new FormData;t.append("title",m.value||""),p.value&&(t.append("file",p.value),t.append("_method","PUT"));try{const v=(await C.post("/multimedia/".concat(f.value),t,{headers:{"Content-Type":"multipart/form-data"}})).data,T=d.value.findIndex(j=>j.id===v.id);T!==-1&&(d.value[T]=v),y(),alert("Editat correctament!")}catch(s){console.error("Error editant:",s),console.error("Detalls de l'error:",(e=s.response)==null?void 0:e.data),alert("Error al guardar els canvis.")}},b=async t=>{if(confirm("Segur que vols eliminar aquest element?"))try{await C.delete("/multimedia/".concat(t)),d.value=d.value.filter(e=>e.id!==t),alert("Eliminat correctament!")}catch(e){console.error("Error eliminant:",e),alert("Error al eliminar.")}};return S(()=>{E()}),q(()=>M.fullPath,()=>{E()}),(t,e)=>(n(),k(a(H),null,{default:l(()=>[o(a(B),null,{default:l(()=>[o(a(w),{color:"primary"},{default:l(()=>[o(a(V),null,{default:l(()=>e[1]||(e[1]=[r("Meus")])),_:1})]),_:1})]),_:1}),o(a(D),{class:"ion-padding"},{default:l(()=>[o(a(G),{class:"multimedia-list"},{default:l(()=>[(n(!0),u(z,null,R(d.value,s=>(n(),k(a(W),{key:s.id,class:"multimedia-card"},{default:l(()=>[o(a(X),null,{default:l(()=>[o(a(Y),{class:"card-title"},{default:l(()=>[r(Z(s.title||"Sense títol"),1)]),_:2},1024)]),_:2},1024),o(a(ee),{class:"card-content"},{default:l(()=>[h(s.path)?(n(),u("img",{key:0,src:a(g)(s.path),alt:"Imatge",class:"media"},null,8,te)):x(s.path)?(n(),u("video",{key:1,src:a(g)(s.path),controls:"",class:"media"},null,8,le)):(n(),u("p",oe,"Format no suportat")),F("div",se,[o(a(_),{color:"primary",onClick:v=>$(s)},{default:l(()=>e[2]||(e[2]=[r("Editar")])),_:2},1032,["onClick"]),o(a(_),{color:"danger",onClick:v=>b(s.id)},{default:l(()=>e[3]||(e[3]=[r("Eliminar")])),_:2},1032,["onClick"])])]),_:2},1024)]),_:2},1024))),128))]),_:1}),d.value.length?L("",!0):(n(),k(a(A),{key:0,class:"no-content"},{default:l(()=>e[4]||(e[4]=[r("No has pujat cap multimèdia.")])),_:1})),o(a(J),{"is-open":I.value,onDidDismiss:y},{default:l(()=>[o(a(B),null,{default:l(()=>[o(a(w),null,{default:l(()=>[o(a(V),null,{default:l(()=>e[5]||(e[5]=[r("Editar multimèdia")])),_:1}),o(a(O),{slot:"end"},{default:l(()=>[o(a(_),{onClick:y},{default:l(()=>e[6]||(e[6]=[r("Tancar")])),_:1})]),_:1})]),_:1})]),_:1}),o(a(D),{class:"ion-padding"},{default:l(()=>[h(i.value)?(n(),u("img",{key:0,src:a(g)(i.value),alt:"Imatge actual",class:"modal-media"},null,8,ne)):x(i.value)?(n(),u("video",{key:1,src:a(g)(i.value),controls:"",class:"modal-media"},null,8,re)):(n(),u("p",de,"Format no suportat")),o(a(K),{modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=s=>m.value=s),placeholder:"Títol",class:"modal-input"},null,8,["modelValue"]),F("input",{type:"file",onChange:N,accept:"image/*,video/*",class:"modal-file-input"},null,32),o(a(_),{expand:"block",onClick:U},{default:l(()=>e[7]||(e[7]=[r("Guardar")])),_:1})]),_:1})]),_:1},8,["is-open"])]),_:1})]),_:1}))}}),me=ae(ue,[["__scopeId","data-v-3f6a0a95"]]);export{me as default};
